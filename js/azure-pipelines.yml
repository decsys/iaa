trigger:
  - master
stages:
  - stage: Build
    jobs:
      - job: build
        pool:
          vmImage: ubuntu-latest
        steps:
          - script: |
              npm ci
              npm run build
            workingDirectory: js
          - upload: js
  - stage: Release
    #condition: "and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))"
    jobs:
      - deployment: npm
        environment: github
        pool:
          vmImage: ubuntu-latest
        strategy:
          runOnce:
            deploy:
              steps:
                - bash: >-
                    cp -r $(Pipeline.Workspace)/drop/**/*
                    $(System.DefaultWorkingDirectory)
                - task: Npm@1
                  inputs:
                    command: publish
                    publishEndpoint: npmjs
